## 无尽虚空塔总结

# 策划需求：

1. 爬塔副本
2. 由第一层进入副本或通过试炼之柱进入副本
3. 试炼之柱独立在无尽虚空塔外，试炼之柱和无尽虚空塔是不同的场景进程
4. 试炼之柱场景退出条件为玩家主动退出和伤害量测试倒计时结束
5. 在攻击试炼之柱时需要实事同步玩家的伤害量和当前伤害量的结果层，最后根据伤害量通过读取配置前往无尽虚空塔某一层，结果层不会大于自身记录最大层，最小也会前往第一层
6. 爬塔过程中每层(策划配置)获得一个助战道具(策划配置)，助战道具只存在于无尽虚空塔副本中，若玩家没有选择助战道具，则销毁该助战道具
7. 助战道具主动或被动使用可对自己或怪物通过buff照成某个影响(策划配置)
8. 在无尽虚空塔中，会根据怪物与玩家的神火评分进行伤害量的改变(目前只有怪物压制玩家，没有玩家压制怪物)
9. 无尽虚空塔奖励产出只有玩家首通和扫荡
10. 无尽虚空塔有本周排行榜和上周排行榜，本周排行榜在玩家通关某一层时更新，上周排行榜只保存上周排名记录周一零点更新，两个排行榜均为跨服排行榜
11. 当在周一零点，本周排行榜转上周排行榜时，通过邮件发放上周排行榜排名奖励

# 相关总结：

1. 目前无尽虚空塔包含第0层试炼之柱共有150层，每20层更换一张地图，共9张地图，在 AbstractScene 模块中应当选择副本类型来初始化副本而不应该使用地图id
2. 在通过攻击试炼之柱测试伤害量给客户端同步数据时，需要实事发送当前伤害量的结果层给客户端，但是结果层需要根据伤害量对比配置表得到，因此为了避免重复读表，应当将表数据存储在 scene_data 中
3. 在通过攻击试炼之柱测试伤害量给客户端同步数据时，应当从 scene_data 中获得玩家id，再通过玩家id发送消息个客户端，如果直接使用 attacker.id，则幻兽造成的伤害不会被发送
4. 在通过攻击试炼之柱测试伤害量给客户端同步数据时，应当人为设置消息发送间隔，避免消息发送过于频繁造成服务器卡顿
5. 助战道具目前分为4类，直接使用给予buff、直接使用给予随机buff、携带buff常驻丢弃buff消失、根据玩家角色血量被动触发buff，配置表中助战道具的数据类型为[buff_id, buff_level, use_type, item_type], item_type 为助战道具类型(目前为 1 携带类、2 使用类、3 触发类、4 随机类)，use_type 为使用类型(目前为 1 对玩家使用、0 对怪物使用)，携带类的道具在每层开始时遍历助战道具栏检测到携带类道具时生效，触发类道具则在血量变化为配置值时遍历助战道具栏检测到触发类道具时生效(若有多个触发类道具，根据配置的优先级，优先使用品质高的)
6. 在选取助战道具时，应当对客户端发送的信息进行校验，防止客户端发送错误内容的消息
7. 根据神火评分进行伤害量修改时，需要注意技能伤害和buff伤害；玩家伤害、幻兽伤害和怪物伤害，需要对战斗格式和buff都进行修改
8. 当在周一零点，本周排行榜转上周排行榜时，需要注意设置为只允许world服可进行操作，以防排行榜被多个服务器多次修改，奖励发放时也应当只允许world服发放奖励