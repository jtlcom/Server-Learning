# 活动副本各函数

* 副本创建流程移步[副本实例进入流程](/lib/副本实例进入流程.md)

各个活动副本代码结构大致相同:
* `init/1` 该函数一般用于初始化
    1. 向进程字典中存入相关数据
    2. 返回副本状态。
* `on_timer/2` 少部分模块有使用,有关怪物计时。
* `player_enter/2` 玩家进入副本
    1. 将player和副本结束时间存入进程字典
    2. 向客户端发送副本结束时间，以及初始化的怪物击杀数：0。
* `player_enter_again/2` 玩家重进副本。向客户端发送相应的消息（同上）。
* `leave/1` 玩家退出副本。经过一系列辗转之后会调用到本模块的exit函数。
* `exit/2` 玩家退出副本。
    1. 根据怪物是否已经全部被击杀来判断是否成功通过副本。
    2. 调用handle_result来结算奖励。
    3. 发送玩家hp。
    4. 删除进程字典与该玩家对应的player
* `handle_result/1` 结算玩家奖励
    1. 判断是否成功通过，没通过无奖励
    2. 根据通过星级获取道具掉落组
    3. 计算运营活动额外奖励
    4. 发送消息
* `on_instance_end/2` 结束副本（强制退出）
    1. 判断是否超时
    2. 判断怪物是否全部击杀
    3. 调用handle_result
* `entity_die/3`  击杀怪物调用
    1. 判断是否是怪物
    2. 根据时间获取道具掉落组
    3. 获取奖励
    4. 发送消息
    5. 判断是否全部击杀：调用handle_result
* `entity_hurt/4` 基本上不做处理
* `player_leave` 发送玩家的hp信息
