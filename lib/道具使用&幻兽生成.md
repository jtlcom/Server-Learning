# 幻兽蛋生成幻兽

## 配置转表&数据含义

### 道具表

道具表中的每一个道具都对应了一个使用规则（即使用逻辑、逻辑参数_1 字段）；其中使用逻辑（4）表示为幻兽孵化，逻辑参数_1指定了生成幻兽的id、等级、星级以及属性权重等。

* 逻辑参数_1: `eudemon_id;level;star#weight_ids` 幻兽id为必配数据

* `weight_ids: id1;id2...`；表中数据如：1001;1002

故在转表时，需将权重加入action规则中

```javaScript
if (useParam1 != undefined) {   //useParam1为逻辑参数_1字段，将其拆分为两部分
    var [useParamLine1, useParamLine2] = useParam1.split('#');
}

if (useMode1 > 0) {
    actions = addAction({}, useMode1, useType1, useParamLine1, consume1, useParamLine2);//使用addAction将这些数据加入规则中
}


function addAction(obj, mode, type, params, consume, weight) {
  if (actions.hasOwnProperty(type)) {
    obj[actions[type]] = {  //actions是一个使用逻辑的键值对 如 "4": "eudemon"
      mode: mode,
      params: params == undefined ? [] : params.split(';').map(function(x) { return isNaN(x) ? x.toLowerCase() : Number(x); }),
      consume: !!consume,
      weight: weight == undefined ? [] : weight.split(';').map(function(x) { return isNaN(x) ? x.toLowerCase() : Number(x); })
    }
  }
  return obj;
};
```

### 幻兽初副属性库

在此表中，权重id对应一个生成权重；其格式为二维数组

* 转表后生成权重数据格式为： `[[40, 0], [60, 20], [80, 6], [90, 3], [100, 1]]`

* 其含义为 有0/30(0+20+6+3+1)的概率取到0-40之间的一个随机数；有20/30的概率取到40-60之间的一个随机数，其余数据同上。

* 其数据用途为： 如有一属性A值会在10 - 20之间，则会有20/30的概率在14(其值计算为：10+(20-10)*40/100) 到 16(10+(20-10)*60/100)之间随机取。当固定取最大值时权重为：[[100, 0], [100, 1]]

---

## 道具使用

在道具使用时，根据action规则判断是哪一类道具，执行不同的declare函数。
* 某一幻兽蛋的action取出如下：`{:eudemon, %{consume: true, mode: 1, params: [203030201], weight: [1001, 1002]}}` 

---

## 幻兽生成

`Eudemon.new(id, weight // [])`

* 将七个属性计算并附上值：如该权重id中有该属性，则利用权重进行计算；否则在该属性为副属性时使用默认权重进行计算，为主属性时使用属性最小值

* 最后计算相性，天赋，评分等；并返回一个Map
