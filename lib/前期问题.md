# 前期问题处理方法

## 目录

* [Elixir无法下载](#elixir无法下载)
* [环境变量](#环境变量)
* [erl不是内部或外部命令](#erl不是内部或外部命令)
* [无法运行项目](#无法运行项目)
  * [原因](#原因)
  * [处理方法](#处理方法)
    * [未拉取依赖](#未拉取依赖)
    * [未加入timeout的环境变量](#未加入timeout的环境变量)
    * [无法拉取依赖](#无法拉取依赖)
    * [项目的绝对路径中含有汉字](#项目的绝对路径中含有汉字)
    * [未删去因编译产生的文件](#未删去因编译产生的文件)
    * [部分依赖会编译报错](#部分依赖会编译报错)
    * [拉取依赖过慢的原因](#拉取依赖过慢的原因)

## Elixir无法下载

由于**某种原因**，我们无法通过官网提供的安装方法来安装Elixir，解决方法如下:

1. 无法通过官网提供的安装方法来安装Elixir
<http://elixir-lang.org/elixir.csv>
![avatar](/res/TIM截图20190822112557.jpg)
2. 打开目录中的如下文件，选择自己将要下载的版本下载
![avatar](/res/TIM截图20190822113839.jpg)
![avatar](/res/TIM截图20190822113924.jpg)
3. 解压
将下载的文件解压到同一个目录
![avatar](/res/TIM截图20190822114157.jpg)

## 环境变量

在**高级系统设置**中打开**环境变量**，把bin目录的绝对路径添加(**不要覆盖**)到**系统变量**的path里面，可在cmd中输入iex进行验证

![avatar](/res/TIM截图20190822114421.jpg)

## erl不是内部或外部命令

如果输入iex后，控制台返回“'erl.exe'不是内部或外部命令”。这种情况的原因是path中没有erlang的路径，**将erlang的bin目录也添加到Path即可解决**

![avatar](/res/TIM截图20190822114702.jpg)

## 无法运行项目

### 原因

导致控制台中无法运行项目的原因可能有如下几种：

1. 项目的绝对路径中，含有除ASCII码以外的字符(如汉字、汉语标点、emoji等)
2. 项目中含有外部依赖，但本地没有拉取依赖
3. 项目中**的_build目录和mix.lock文件**是在错误环境下建立的

### 处理方法

![avatar](/res/TIM截图20190926160644.jpg)

#### 未拉取依赖

在刚拉下来的Elixir项目中，如果直接输入 **iex -S mix** ,则会导致控制台报错，具体情况如下：

![avatar](/res/TIM截图20190925183804.jpg)

导致这种问题的原因很简单，我们在项目中导入了大量的Hex外部依赖，而在本地的项目文件中却没有解决依赖问题(即本地没有依赖文件)。在控制台的输出中，也有提示 让我们运行如下的命令：

```shell
mix deps.get
```

#### 未加入timeout的环境变量

而在运行该命令时，由于**某种原因**，我们可能无法顺利的拉取依赖，发生这种情况时，在控制台上也会有提示解决方法，即在环境变量中的系统变量加入如下两个变量与值

* HEX_HTTP_CONCURRENCY 1
* HEX_HTTP_TIMEOUT 120

![avatar](/res/TIM截图20190822115405.jpg)

#### 无法拉取依赖

由于**某种原因**，可能部分依赖一直无法拉到，这种情况下，可以参考以下的方法进行解决：

1. 在系统变量中加入HEX的镜像和CDN加速地址：HEX_MIRROR="https://hexpm.upyun.com" HEX_CDN="https://hexpm.upyun.com"
2. 在控制台中输入HEX镜像地址：mix hex.config mirror_url https://repo.hex.pm 或者 mix hex.config mirror_url https://hex.pm/docs/mirrors
3. 在控制台中更改HEX地址：mix hex.repo set hexpm --url https://hexpm.upyun.com

以上三种方法的原理都是更改依赖源的地址，从而成功获取依赖。方法参考自[Ruby 中文社区](https://ruby-china.org/topics/31631)。

#### 项目的绝对路径中含有汉字

在项目编译过程中，部分外部依赖可能会突然报错，这主要是因为项目的绝对路径中含有除ASCII码以外的字符(如汉字、汉语标点、emoji等)，如果发生这种情况，需要关闭控制台后，修改绝对路径中出现的这类字符

![avatar](/res/TIM截图20190926144942.jpg)

#### 未删去因编译产生的文件

在解决完以上的问题后，我们重新运行项目，会发生如下的问题：

![avatar](/res/TIM截图20190926150023.jpg)

这种报错的解决方法也很简单，只需要到项目的目录中，将**deps目录、_build目录和mix.lock文件**删去，然后运行如下命令即可解决问题。

```shell
mix clean
mix deps.get
```

#### 部分依赖会编译报错

极少数情况下，部分依赖可能会在编译过程中报错，原因可能是文件缺失，版本过低……，这种情况可以参照控制台的提示进行解决，也可选择删去整个deps目录后，重新拉取依赖。
但无论以何种方式解决，都需要在**删去deps目录、_build目录和mix.lock文件、mix clean后**再重新运行项目。

![avatar](/res/TIM截图20190926151901.jpg)

### 拉取依赖过慢的原因

mix从网络中拉取外部依赖(Hex package)的流程类似于B/S模型中的域名解析。

![avatar](/res/TIM截图20190926155145.jpg)

所以在拉取外部依赖时过慢、甚至失败就不难理解了。

---
